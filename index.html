<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Executive Risk Analysis</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;
function App(){
const[geoQ,setGeoQ]=useState('');
const[geoLoad,setGeoLoad]=useState(false);
const[geoAn,setGeoAn]=useState(null);
const[geoErr,setGeoErr]=useState('');
const[geoHist,setGeoHist]=useState([]);
const[geoShow,setGeoShow]=useState(false);
const[geoSearch,setGeoSearch]=useState('');
const[geoPDF,setGeoPDF]=useState(false);

const[cyberQ,setCyberQ]=useState('');
const[cyberLoad,setCyberLoad]=useState(false);
const[cyberAn,setCyberAn]=useState(null);
const[cyberErr,setCyberErr]=useState('');
const[cyberHist,setCyberHist]=useState([]);
const[cyberShow,setCyberShow]=useState(false);
const[cyberSearch,setCyberSearch]=useState('');
const[cyberPDF,setCyberPDF]=useState(false);

useEffect(()=>{loadGeoHist();loadCyberHist()},[]);

const loadGeoHist=async()=>{
try{
const k=await window.storage.list('geo:');
if(k?.keys){
const a=[];
for(const key of k.keys){
try{const r=await window.storage.get(key);if(r)a.push(JSON.parse(r.value))}catch(e){}
}
a.sort((x,y)=>y.timestamp-x.timestamp);
setGeoHist(a);
}
}catch(e){}
};

const loadCyberHist=async()=>{
try{
const k=await window.storage.list('cyber:');
if(k?.keys){
const a=[];
for(const key of k.keys){
try{const r=await window.storage.get(key);if(r)a.push(JSON.parse(r.value))}catch(e){}
}
a.sort((x,y)=>y.timestamp-x.timestamp);
setCyberHist(a);
}
}catch(e){}
};

const analyzeGeo=async()=>{
if(!geoQ.trim()){setGeoErr('Enter a question');return}
setGeoLoad(true);setGeoErr('');setGeoAn(null);
try{
const res=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:geoQ,type:'geopolitical'})});
const data=await res.json();
if(data.error)throw new Error(data.error);
const txt=data.content.filter(i=>i.type==='text').map(i=>i.text).join('');
const m=txt.match(/\{[\s\S]*\}/);
if(!m)throw new Error('Parse error');
const parsed=JSON.parse(m[0]);
setGeoAn(parsed);
const id=Date.now().toString();
await window.storage.set(`geo:${id}`,JSON.stringify({id,question:geoQ,analysis:parsed,timestamp:Date.now()}));
await loadGeoHist();
}catch(e){setGeoErr(e.message||'Error')}finally{setGeoLoad(false)}
};

const analyzeCyber=async()=>{
if(!cyberQ.trim()){setCyberErr('Enter scenario');return}
setCyberLoad(true);setCyberErr('');setCyberAn(null);
try{
const res=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:cyberQ,type:'cyber'})});
const data=await res.json();
if(data.error)throw new Error(data.error);
const txt=data.content.filter(i=>i.type==='text').map(i=>i.text).join('');
const m=txt.match(/\{[\s\S]*\}/);
if(!m)throw new Error('Parse error');
const parsed=JSON.parse(m[0]);
setCyberAn(parsed);
const id=Date.now().toString();
await window.storage.set(`cyber:${id}`,JSON.stringify({id,scenario:cyberQ,analysis:parsed,timestamp:Date.now()}));
await loadCyberHist();
}catch(e){setCyberErr(e.message||'Error')}finally{setCyberLoad(false)}
};

const dlGeoPDF=async()=>{
if(!geoAn)return;
setGeoPDF(true);
try{
const el=document.getElementById('geo-pdf');
await html2pdf().set({margin:10,filename:`geo-${Date.now()}.pdf`,image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}).from(el).save();
}catch(e){setGeoErr('PDF error')}finally{setGeoPDF(false)}
};

const dlCyberPDF=async()=>{
if(!cyberAn)return;
setCyberPDF(true);
try{
const el=document.getElementById('cyber-pdf');
await html2pdf().set({margin:10,filename:`cyber-${Date.now()}.pdf`,image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}).from(el).save();
}catch(e){setCyberErr('PDF error')}finally{setCyberPDF(false)}
};

const pestleCats=[
{key:'political',label:'Political',color:'bg-blue-100 text-blue-800'},
{key:'economic',label:'Economic',color:'bg-green-100 text-green-800'},
{key:'social',label:'Social',color:'bg-purple-100 text-purple-800'},
{key:'technological',label:'Technological',color:'bg-cyan-100 text-cyan-800'},
{key:'legal',label:'Legal',color:'bg-amber-100 text-amber-800'},
{key:'environmental',label:'Environmental',color:'bg-emerald-100 text-emerald-800'},
{key:'military',label:'Military',color:'bg-red-100 text-red-800'}
];

const cyberCats=[
{key:'legal_compliance',label:'Legal or Compliance Failure',color:'bg-red-100 text-red-800',icon:'‚öñÔ∏è'},
{key:'operational_disruption',label:'Operational Disruption',color:'bg-orange-100 text-orange-800',icon:'‚ö†Ô∏è'},
{key:'brand_impairment',label:'Brand Impairment',color:'bg-purple-100 text-purple-800',icon:'üìâ'},
{key:'financial_fraud',label:'Financial Fraud',color:'bg-amber-100 text-amber-800',icon:'üí∞'},
{key:'competitive_disadvantage',label:'Competitive Disadvantage',color:'bg-blue-100 text-blue-800',icon:'üéØ'}
];

const scenColors={Baseline:'border-blue-500 bg-blue-50',Plausible:'border-amber-500 bg-amber-50',Wildcard:'border-purple-500 bg-purple-50'};

return(
<div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
<div className="max-w-6xl mx-auto">
<header className="text-center mb-12">
<h1 className="text-5xl font-bold text-slate-800 mb-3">Executive Risk Analysis</h1>
<p className="text-lg text-slate-600">Analyze geopolitical scenarios and cyber business risks</p>
</header>

{/* GEO SECTION */}
<div className="mb-16">
<div className="mb-6">
<h2 className="text-3xl font-bold text-slate-800 mb-2">Future Geopolitical Scenario Analysis</h2>
<p className="text-slate-600">Strategic foresight powered by PESTLE-M framework</p>
</div>

<div className="bg-white rounded-lg shadow-lg p-6 mb-6">
{geoHist.length>0&&(
<div className="flex gap-2 mb-4">
<button onClick={()=>setGeoShow(!geoShow)} className="px-4 py-2 text-sm bg-slate-100 hover:bg-slate-200 rounded-lg">üìä History ({geoHist.length})</button>
{geoAn&&<button onClick={dlGeoPDF} disabled={geoPDF} className="px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 rounded-lg">{geoPDF?'‚è≥ Generating...':'üì• Download PDF'}</button>}
</div>
)}

{geoShow&&geoHist.length>0&&(
<div className="mb-4">
<input type="text" value={geoSearch} onChange={(e)=>setGeoSearch(e.target.value)} placeholder="üîç Search..." className="w-full px-4 py-2 mb-3 border rounded-lg focus:ring-2 focus:ring-blue-500"/>
<div className="max-h-64 overflow-y-auto border rounded-lg">
{geoHist.filter(i=>i.question.toLowerCase().includes(geoSearch.toLowerCase())).map(i=>(
<button key={i.id} onClick={()=>{setGeoQ(i.question);setGeoAn(i.analysis);setGeoShow(false)}} className="w-full text-left p-4 hover:bg-slate-50 border-b last:border-b-0">
<p className="font-medium text-slate-800">{i.question}</p>
<p className="text-xs text-slate-500 mt-1">üïê {new Date(i.timestamp).toLocaleString()}</p>
</button>
))}
</div>
</div>
)}

<div className="mb-4">
<label className="block text-sm font-medium text-slate-700 mb-2">Ask your question about the future</label>
<textarea value={geoQ} onChange={(e)=>setGeoQ(e.target.value)} placeholder="e.g. Will China invade Taiwan?" rows={3} className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"/>
</div>

<button onClick={analyzeGeo} disabled={geoLoad} className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white font-semibold py-3 px-6 rounded-lg">
{geoLoad?<><div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"></div>Analyzing...</>:'üöÄ Analyze Geopolitical Scenario'}
</button>

{geoErr&&<div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg"><span className="text-red-600">‚ö†Ô∏è</span> {geoErr}</div>}
</div>

{geoAn&&(
<>
<div id="geo-pdf" style={{position:'absolute',left:'-9999px',width:'800px',padding:'40px',fontFamily:'Arial'}}>
<h1 style={{color:'#1e40af',borderBottom:'3px solid #1e40af',paddingBottom:'10px'}}>Geopolitical Analysis</h1>
<div style={{color:'#64748b',margin:'20px 0'}}>Generated: {new Date().toLocaleDateString()}</div>
<div style={{background:'#f1f5f9',padding:'15px',borderLeft:'4px solid #3b82f6',margin:'20px 0'}}><strong>Question:</strong> {geoQ}</div>
<h2 style={{marginTop:'30px'}}>PESTLE-M Analysis</h2>
{Object.entries(geoAn.pestle_analysis).map(([k,v])=>(
<div key={k} style={{margin:'15px 0',padding:'15px',background:'#f8fafc',borderRadius:'8px'}}>
<div style={{fontWeight:'bold',textTransform:'uppercase',marginBottom:'8px'}}>{k}</div>
<div>{v}</div>
</div>
))}
{geoAn.scenarios&&(<><h2 style={{marginTop:'30px'}}>Scenarios</h2>
{geoAn.scenarios.map((s,i)=>(
<div key={i} style={{margin:'15px 0',padding:'20px',border:'2px solid #cbd5e1',borderRadius:'8px'}}>
<h3>{s.type} ({s.probability}%)</h3>
<p><strong>Timeframe:</strong> {s.timeframe}</p>
<p>{s.description}</p>
<p><strong>Indicators:</strong></p>
<ul>{s.key_indicators.map((ind,j)=><li key={j}>{ind}</li>)}</ul>
</div>
))}</>)}
{geoAn.strategic_questions&&(<><h2 style={{marginTop:'30px'}}>Strategic Questions</h2>
<ol>{geoAn.strategic_questions.map((q,i)=><li key={i} style={{margin:'10px 0'}}>{q}</li>)}</ol></>)}
{geoAn.data_sources&&(<><h2 style={{marginTop:'30px'}}>Sources</h2>
<ul>{geoAn.data_sources.map((s,i)=><li key={i} style={{margin:'8px 0'}}>{s}</li>)}</ul></>)}
</div>

<div className="space-y-6">
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">PESTLE-M Analysis</h2>
<div className="grid md:grid-cols-2 gap-4">
{pestleCats.map(({key,label,color})=>(
<div key={key} className="border rounded-lg p-4">
<div className={`inline-block px-3 py-1 rounded-full text-sm font-semibold mb-2 ${color}`}>{label}</div>
<p className="text-slate-700 text-sm">{geoAn.pestle_analysis[key]}</p>
</div>
))}
</div>
</div>

<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-2">Future Scenarios</h2>
<p className="text-slate-600 mb-6">{geoAn.overall_assessment}</p>
<div className="space-y-4">
{geoAn.scenarios.map((s,idx)=>(
<div key={idx} className={`border-l-4 rounded-lg p-5 ${scenColors[s.type]}`}>
<div className="flex justify-between mb-3">
<h3 className="text-xl font-bold">{s.type} Scenario</h3>
<div className="text-2xl font-bold">{s.probability}%</div>
</div>
<p className="mb-3">{s.description}</p>
<p className="mb-3"><strong>Timeframe:</strong> {s.timeframe}</p>
<p className="font-semibold text-sm mb-2">Key Indicators:</p>
<ul className="list-disc list-inside space-y-1">
{s.key_indicators.map((ind,i)=><li key={i} className="text-sm">{ind}</li>)}
</ul>
</div>
))}
</div>
</div>

{geoAn.strategic_questions&&(
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Strategic Questions for Leadership</h2>
<p className="text-slate-600 mb-4">Critical questions executives should ask</p>
<ol className="space-y-3">
{geoAn.strategic_questions.map((q,idx)=>(
<li key={idx} className="flex gap-3">
<span className="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold">{idx+1}</span>
<span>{q}</span>
</li>
))}
</ol>
</div>
)}

{geoAn.data_sources&&(
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Data Sources & References</h2>
<ul className="space-y-2">
{geoAn.data_sources.map((src,idx)=>(
<li key={idx} className="flex gap-2"><span>üìö</span><span>{src}</span></li>
))}
</ul>
</div>
)}
</div>
</>
)}
</div>

{/* CYBER SECTION */}
<div className="border-t-4 border-slate-300 pt-16">
<div className="mb-6">
<h2 className="text-3xl font-bold text-slate-800 mb-2">Cyber Business Risk Analysis</h2>
<p className="text-slate-600">Assess business impact of cyber security scenarios</p>
</div>

<div className="bg-white rounded-lg shadow-lg p-6 mb-6">
{cyberHist.length>0&&(
<div className="flex gap-2 mb-4">
<button onClick={()=>setCyberShow(!cyberShow)} className="px-4 py-2 text-sm bg-slate-100 hover:bg-slate-200 rounded-lg">üìä History ({cyberHist.length})</button>
{cyberAn&&<button onClick={dlCyberPDF} disabled={cyberPDF} className="px-4 py-2 text-sm text-white bg-red-600 hover:bg-red-700 disabled:bg-slate-400 rounded-lg">{cyberPDF?'‚è≥ Generating...':'üì• Download PDF'}</button>}
</div>
)}

{cyberShow&&cyberHist.length>0&&(
<div className="mb-4">
<input type="text" value={cyberSearch} onChange={(e)=>setCyberSearch(e.target.value)} placeholder="üîç Search..." className="w-full px-4 py-2 mb-3 border rounded-lg focus:ring-2 focus:ring-red-500"/>
<div className="max-h-64 overflow-y-auto border rounded-lg">
{cyberHist.filter(i=>i.scenario.toLowerCase().includes(cyberSearch.toLowerCase())).map(i=>(
<button key={i.id} onClick={()=>{setCyberQ(i.scenario);setCyberAn(i.analysis);setCyberShow(false)}} className="w-full text-left p-4 hover:bg-slate-50 border-b last:border-b-0">
<p className="font-medium text-slate-800">{i.scenario}</p>
<p className="text-xs text-slate-500 mt-1">üïê {new Date(i.timestamp).toLocaleString()}</p>
</button>
))}
</div>
</div>
)}

<div className="mb-4">
<label className="block text-sm font-medium text-slate-700 mb-2">Describe your cyber scenario</label>
<textarea value={cyberQ} onChange={(e)=>setCyberQ(e.target.value)} placeholder="e.g. A ransomware group successfully compromises an organisation" rows={3} className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-red-500 resize-none"/>
</div>

<button onClick={analyzeCyber} disabled={cyberLoad} className="w-full bg-red-600 hover:bg-red-700 disabled:bg-slate-400 text-white font-semibold py-3 px-6 rounded-lg">
{cyberLoad?<><div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"></div>Analyzing...</>:'üîí Analyze Cyber Risk'}
</button>

{cyberErr&&<div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg"><span className="text-red-600">‚ö†Ô∏è</span> {cyberErr}</div>}
</div>

{cyberAn&&(
<>
<div id="cyber-pdf" style={{position:'absolute',left:'-9999px',width:'800px',padding:'40px',fontFamily:'Arial'}}>
<h1 style={{color:'#dc2626',borderBottom:'3px solid #dc2626',paddingBottom:'10px'}}>Cyber Business Risk Analysis</h1>
<div style={{color:'#64748b',margin:'20px 0'}}>Generated: {new Date().toLocaleDateString()}</div>
<div style={{background:'#fee2e2',padding:'15px',borderLeft:'4px solid #dc2626',margin:'20px 0'}}><strong>Scenario:</strong> {cyberQ}</div>
<h2 style={{marginTop:'30px'}}>Business Risk Analysis</h2>
{cyberCats.map(({key,label})=>(
<div key={key} style={{margin:'15px 0',padding:'15px',background:'#f8fafc',borderRadius:'8px'}}>
<div style={{fontWeight:'bold',marginBottom:'8px'}}>{label}</div>
<div>{cyberAn.business_risks[key]}</div>
</div>
))}
<h2 style={{marginTop:'30px'}}>Overall Impact</h2>
<p>{cyberAn.overall_impact}</p>
<h2 style={{marginTop:'30px'}}>Financial Impact</h2>
<p><strong>Average Cost:</strong> {cyberAn.average_cost}</p>
{cyberAn.executive_questions&&(<><h2 style={{marginTop:'30px'}}>Executive Questions</h2>
<ol>{cyberAn.executive_questions.map((q,i)=><li key={i} style={{margin:'10px 0'}}>{q}</li>)}</ol></>)}
{cyberAn.data_sources&&(<><h2 style={{marginTop:'30px'}}>Sources</h2>
<ul>{cyberAn.data_sources.map((s,i)=><li key={i} style={{margin:'8px 0'}}>{s}</li>)}</ul></>)}
</div>

<div className="space-y-6">
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Business Risk Analysis</h2>
<div className="grid md:grid-cols-2 gap-4">
{cyberCats.map(({key,label,color,icon})=>(
<div key={key} className="border rounded-lg p-4">
<div className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold mb-2 ${color}`}>
<span>{icon}</span><span>{label}</span>
</div>
<p className="text-slate-700 text-sm">{cyberAn.business_risks[key]}</p>
</div>
))}
</div>
</div>

<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Overall Business Impact</h2>
<p className="text-slate-700 mb-6">{cyberAn.overall_impact}</p>
<div className="bg-amber-50 border-l-4 border-amber-500 p-4">
<p className="font-semibold text-amber-900 mb-2">üí∞ Financial Impact</p>
<p className="text-amber-800"><strong>Average Cost:</strong> {cyberAn.average_cost}</p>
<p className="text-sm text-amber-700 mt-2">Based on industry data and similar incident reports</p>
</div>
</div>

{cyberAn.executive_questions&&(
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Executive Questions for Security & Risk Teams</h2>
<p className="text-slate-600 mb-4">Critical questions to assess your organization's preparedness</p>
<ol className="space-y-3">
{cyberAn.executive_questions.map((q,idx)=>(
<li key={idx} className="flex gap-3">
<span className="flex-shrink-0 w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold">{idx+1}</span>
<span>{q}</span>
</li>
))}
</ol>
</div>
)}

{cyberAn.data_sources&&(
<div className="bg-white rounded-lg shadow-lg p-6">
<h2 className="text-2xl font-bold text-slate-800 mb-4">Data Sources & References</h2>
<p className="text-slate-600 mb-4">Industry reports and research that informed this analysis</p>
<ul className="space-y-2">
{cyberAn.data_sources.map((src,idx)=>(
<li key={idx} className="flex gap-2"><span>üìö</span><span>{src}</span></li>
))}
</ul>
</div>
)}
</div>
</>
)}
</div>
</div>
</div>
);
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
